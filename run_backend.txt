@echo off
setlocal

rem Change to the folder where this script lives
cd /d "%~dp0"

rem If there is a backend subfolder (project root), go into it
if exist "backend\main.py" (
    cd backend
) else (
    rem Otherwise assume we are already inside backend
    if not exist "main.py" (
        echo [ERROR] Could not find backend\main.py or main.py.
        echo Make sure run_backend.bat is either:
        echo   - In G:\Trading Bot V2.1\  (with backend\main.py), or
        echo   - In G:\Trading Bot V2.1\backend\  (next to main.py).
        pause
        exit /b 1
    )
)

rem Activate the venv if it exists
if exist ".venv\Scripts\activate.bat" (
    call ".venv\Scripts\activate.bat"
) else (
    echo [WARN] .venv\Scripts\activate.bat not found. Using system python...
)

echo Starting backend (FastAPI) on http://127.0.0.1:8000 ...
python -m uvicorn main:app --host 127.0.0.1 --port 8000

echo.
echo Backend process exited with code %ERRORLEVEL%.
pause
endlocal
